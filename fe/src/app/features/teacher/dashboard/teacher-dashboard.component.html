<div class="dashboard-container">
  <!-- Main Column (70%) -->
  <div class="main-column">
    <!-- Header: Greeting -->
    <div class="dashboard-header">
      <h1 class="greeting">{{ getGreeting() }}, {{ getUserFirstName() }}</h1>
      <p class="subtitle">Chào mừng trở lại với Teacher Portal</p>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-section">
      <div class="kpi-card">
        <div class="kpi-icon">
          <app-icon name="academic-cap" size="md" />
        </div>
        <div class="kpi-content">
          <p class="kpi-value">{{ teacher.totalCourses() }}</p>
          <p class="kpi-label">Tổng khóa học</p>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon">
          <app-icon name="users" size="md" />
        </div>
        <div class="kpi-content">
          <p class="kpi-value">{{ teacher.totalStudents() }}</p>
          <p class="kpi-label">Tổng học viên</p>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon">
          <app-icon name="clipboard-document-check" size="md" />
        </div>
        <div class="kpi-content">
          <p class="kpi-value">{{ pendingAssignmentsCount() }}</p>
          <p class="kpi-label">Bài tập chờ chấm</p>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon">
          <app-icon name="star" size="md" />
        </div>
        <div class="kpi-content">
          <p class="kpi-value">{{ averageRating() }}</p>
          <p class="kpi-label">Đánh giá TB</p>
        </div>
      </div>
    </div>

    <!-- Recent Items Section with Tabs -->
    <div class="section">
      <div class="section-header">
        <div class="tabs-container" role="tablist">
          <button 
            class="tab-chip"
            [class.active]="isActiveTab('courses')"
            (click)="switchTab('courses')"
            role="tab"
            [attr.aria-selected]="isActiveTab('courses')"
            type="button">
            <span class="tab-label">Khóa học gần đây</span>
          </button>
          <button 
            class="tab-chip"
            [class.active]="isActiveTab('assignments')"
            (click)="switchTab('assignments')"
            role="tab"
            [attr.aria-selected]="isActiveTab('assignments')"
            type="button">
            <span class="tab-label">Bài tập chờ chấm</span>
          </button>
        </div>
        <a 
          [routerLink]="isActiveTab('courses') ? ['/teacher/courses'] : ['/teacher/assignments']" 
          class="view-all-link">
          Xem tất cả
          <app-icon name="arrow-right" size="xs" />
        </a>
      </div>

      <!-- Courses Tab Content -->
      @if (isActiveTab('courses')) {
        <div class="courses-list">
          @for (course of recentCourses(); track course.id) {
            <div class="course-card-wrapper">
              <!-- Course Metadata -->
              <div class="course-metadata">
                <div class="course-header">
                  <div class="course-code">{{ getCourseCode(course) }}</div>
                  <app-badge 
                    [variant]="getStatusVariant(course.status)" 
                    size="sm">
                    {{ getStatusLabel(course.status) }}
                  </app-badge>
                </div>

                <h3 class="course-title">
                  <a [routerLink]="['/teacher/courses', course.id]">
                    {{ course.title }}
                  </a>
                </h3>

                <div class="course-meta">
                  <span>{{ course.category }}</span>
                  <span class="separator">·</span>
                  <span>{{ course.enrolledStudents }} học viên</span>
                  @if (course.rating) {
                    <span class="separator">·</span>
                    <span class="rating">
                      <app-icon name="star" size="xs" />
                      {{ course.rating }}
                    </span>
                  }
                </div>
              </div>

              <!-- Course Actions -->
              <div class="course-actions">
                <app-button 
                  variant="ghost" 
                size="sm"
                (clicked)="editCourse(course.id)">
                <app-icon name="pencil" size="sm" />
                Chỉnh sửa
              </app-button>
              <app-button 
                variant="primary" 
                size="sm"
                (clicked)="viewCourse(course.id)">
                Xem chi tiết
              </app-button>
            </div>
          </div>
        }
        </div>
      }

      <!-- Assignments Tab Content -->
      @if (isActiveTab('assignments')) {
        <div class="assignments-list">
          @for (assignment of pendingAssignments(); track assignment.id) {
            <div class="assignment-card">
              <div class="assignment-info">
                <div class="assignment-header">
                  <h4 class="assignment-title">{{ assignment.title }}</h4>
                  <app-badge 
                    [variant]="getAssignmentStatusVariant(assignment.status)" 
                    size="sm"
                    [dot]="true">
                    {{ getAssignmentStatusLabel(assignment.status) }}
                  </app-badge>
                </div>

                <div class="assignment-meta">
                  <span>{{ assignment.courseTitle }}</span>
                  <span class="separator">·</span>
                  <span>Hạn: {{ assignment.dueDate }}</span>
                </div>

                <div class="assignment-progress">
                  <span class="progress-text">
                    {{ assignment.submissions }}/{{ assignment.totalStudents }} đã nộp
                  </span>
                  <app-progress-bar 
                    [progress]="getSubmissionProgress(assignment)" 
                    [thin]="true" 
                  />
                </div>
              </div>

              <div class="assignment-action">
                <app-button 
                  variant="primary" 
                  size="sm"
                  (clicked)="gradeAssignment(assignment.id)">
                  Chấm bài
                </app-button>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Sidebar (30%) - Widgets -->
  <aside class="sidebar">
    <!-- Quick Stats Widget -->
    <app-card class="widget">
      <h3 class="widget-title">Thống kê nhanh</h3>
      <div class="stats-list">
        <div class="stat-item">
          <span class="stat-label">Khóa học đang hoạt động</span>
          <span class="stat-value">{{ teacher.activeCourses().length }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Bài tập chưa chấm</span>
          <span class="stat-value">{{ pendingGradingCount() }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Học viên mới tuần này</span>
          <span class="stat-value">{{ newStudentsThisWeek() }}</span>
        </div>
      </div>
    </app-card>

    <!-- Top Students Widget -->
    <app-card class="widget">
      <h3 class="widget-title">Học viên xuất sắc</h3>
      <div class="students-list">
        @for (student of topStudents(); track student.id) {
          <div class="student-item">
            <div class="student-info">
              <p class="student-name">{{ student.name }}</p>
              <p class="student-meta">{{ student.email }}</p>
            </div>
            <div class="student-stats">
              <span class="grade">{{ student.averageGrade }}</span>
            </div>
          </div>
        }
      </div>
      <app-button 
        variant="ghost" 
        [fullWidth]="true"
        (clicked)="viewAllStudents()">
        Xem tất cả học viên
      </app-button>
    </app-card>

    <!-- Recent Activity Widget -->
    <app-card class="widget">
      <h3 class="widget-title">Hoạt động gần đây</h3>
      <div class="activity-list">
        @for (activity of recentActivities(); track activity.id) {
          <div class="activity-item">
            <div class="activity-icon">
              <app-icon [name]="getActivityIcon(activity.icon)" size="sm" />
            </div>
            <div class="activity-content">
              <p class="activity-text">{{ activity.text }}</p>
              <p class="activity-time">{{ activity.time }}</p>
            </div>
          </div>
        }
      </div>
    </app-card>
  </aside>
</div>
