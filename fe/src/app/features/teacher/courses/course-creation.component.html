<div class="course-creation-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">Tạo khóa học mới</h1>
      <p class="page-subtitle">Điền thông tin cơ bản để bắt đầu tạo khóa học của bạn</p>
    </div>
  </div>

  <!-- Accordion Container -->
  <div class="accordion-container">
    
    <!-- Section 1: Course Info Form -->
    <div class="accordion-item" [class.expanded]="accordionState.courseInfo">
      <button 
        type="button"
        class="accordion-header" 
        (click)="toggleAccordion('courseInfo')">
        <div class="header-left">
          <app-icon name="academic-cap" size="md" class="header-icon" />
          <h2 class="accordion-title">Thông tin khóa học</h2>
        </div>
        <app-icon 
          [name]="accordionState.courseInfo ? 'chevron-up' : 'chevron-down'" 
          size="sm" 
          class="chevron-icon" />
      </button>

      @if (accordionState.courseInfo) {
        <div class="accordion-content">
          <p class="form-subtitle">Các trường đánh dấu (*) là bắt buộc</p>
          
          <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-content">
            <!-- Course Code -->
            <div class="form-group">
              <label class="form-label" for="courseCode">
                Mã khóa học <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <app-icon name="document-text" size="sm" class="input-icon" />
                <input 
                  id="courseCode"
                  formControlName="code" 
                  type="text" 
                  class="form-input"
                  [class.error]="form.controls.code.invalid && form.controls.code.touched"
                  placeholder="VD: ME101, CS201..." 
                  maxlength="64" />
              </div>
              @if (form.controls.code.invalid && form.controls.code.touched) {
                <div class="error-message">
                  <app-icon name="exclamation-circle" size="xs" />
                  <span>Mã khóa học là bắt buộc (tối đa 64 ký tự)</span>
                </div>
              }
              <p class="help-text">Mã định danh duy nhất cho khóa học. Nên ngắn gọn và dễ nhớ.</p>
            </div>

            <!-- Course Title -->
            <div class="form-group">
              <label class="form-label" for="courseTitle">
                Tên khóa học <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <app-icon name="book-open" size="sm" class="input-icon" />
                <input 
                  id="courseTitle"
                  formControlName="title" 
                  type="text" 
                  class="form-input"
                  [class.error]="form.controls.title.invalid && form.controls.title.touched"
                  placeholder="VD: Lập trình Web cơ bản..." 
                  maxlength="255" />
              </div>
              @if (form.controls.title.invalid && form.controls.title.touched) {
                <div class="error-message">
                  <app-icon name="exclamation-circle" size="xs" />
                  <span>Tên khóa học là bắt buộc (tối đa 255 ký tự)</span>
                </div>
              }
              <p class="help-text">Tên khóa học sẽ hiển thị cho học viên. Nên rõ ràng và hấp dẫn.</p>
            </div>

            <!-- Course Description -->
            <div class="form-group">
              <label class="form-label" for="courseDescription">
                Mô tả khóa học
              </label>
              <textarea 
                id="courseDescription"
                formControlName="description" 
                rows="5" 
                class="form-textarea"
                placeholder="Mô tả ngắn gọn về nội dung, mục tiêu và đối tượng học viên của khóa học..."></textarea>
              <p class="help-text">Mô tả chi tiết giúp học viên hiểu rõ hơn về khóa học.</p>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
              <app-button 
                type="submit"
                variant="primary"
                [disabled]="form.invalid || isSubmitting()">
                @if (isSubmitting()) {
                  <app-icon name="arrow-path" size="sm" class="spin" />
                  <span>Đang tạo khóa học...</span>
                } @else {
                  <app-icon name="plus" size="sm" />
                  <span>Tạo khóa học</span>
                }
              </app-button>

              <app-button 
                type="button"
                variant="ghost"
                (clicked)="cancel()">
                Hủy
              </app-button>
            </div>

            <!-- Success/Error Messages -->
            @if (successMsg()) {
              <div class="success-alert">
                <app-icon name="check-circle" size="sm" />
                <span>{{ successMsg() }}</span>
              </div>
            }

            @if (errorMsg()) {
              <div class="error-alert">
                <app-icon name="exclamation-circle" size="sm" />
                <span>{{ errorMsg() }}</span>
              </div>
            }
          </form>
        </div>
      }
    </div>

    <!-- Section 2: Use Template -->
    <div class="accordion-item" [class.expanded]="accordionState.useTemplate">
      <button 
        type="button"
        class="accordion-header" 
        (click)="toggleAccordion('useTemplate')">
        <div class="header-left">
          <app-icon name="sparkles" size="md" class="header-icon" />
          <h2 class="accordion-title">Sử dụng khóa học làm mẫu</h2>
        </div>
        <app-icon 
          [name]="accordionState.useTemplate ? 'chevron-up' : 'chevron-down'" 
          size="sm" 
          class="chevron-icon" />
      </button>

      @if (accordionState.useTemplate) {
        <div class="accordion-content">
          <p class="template-subtitle">Sao chép thông tin từ khóa học hiện có để tiết kiệm thời gian</p>
          
          <!-- Search -->
          <div class="template-search">
            <app-icon name="magnifying-glass" size="sm" class="search-icon" />
            <input 
              class="search-input" 
              placeholder="Tìm kiếm khóa học..."
              [(ngModel)]="keyword"
              (input)="applyFilters()" />
          </div>

          <!-- Template Table -->
          @if (!loadingCourses() && paged().length > 0) {
            <div class="table-container">
              <table class="template-table">
                <thead>
                  <tr>
                    <th>Mã khóa học</th>
                    <th>Tên khóa học</th>
                    <th class="text-right">Thao tác</th>
                  </tr>
                </thead>
                <tbody>
                  @for (course of paged(); track course.id) {
                    <tr>
                      <td>
                        <span class="course-code">{{ course.code }}</span>
                      </td>
                      <td>
                        <span class="course-title">{{ course.title }}</span>
                      </td>
                      <td class="text-right">
                        <app-button 
                          variant="ghost" 
                          size="sm"
                          [disabled]="prefillingId() === course.id"
                          (clicked)="prefillFrom(course.id)">
                          @if (prefillingId() === course.id) {
                            <app-icon name="arrow-path" size="xs" class="spin" />
                            <span>Đang nạp...</span>
                          } @else {
                            <app-icon name="document-text" size="xs" />
                            <span>Dùng làm mẫu</span>
                          }
                        </app-button>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            <div class="template-pagination">
              <div class="page-size-selector">
                <span>Hiển thị</span>
                <select [ngModel]="pageSize()" (ngModelChange)="onPageSizeChange($event)">
                  <option [ngValue]="5">5</option>
                  <option [ngValue]="10">10</option>
                </select>
                <span>mỗi trang</span>
              </div>
              
              <div class="page-navigation">
                <app-button 
                  variant="ghost" 
                  size="sm"
                  [disabled]="pageIndex() <= 1"
                  (clicked)="prevPage()">
                  Trước
                </app-button>
                <span class="page-info">Trang {{ pageIndex() }} / {{ totalPages() }}</span>
                <app-button 
                  variant="ghost" 
                  size="sm"
                  [disabled]="pageIndex() >= totalPages()"
                  (clicked)="nextPage()">
                  Sau
                </app-button>
              </div>
            </div>
          }

          <!-- Empty State -->
          @if (!loadingCourses() && paged().length === 0) {
            <div class="empty-state">
              <app-icon name="book-open" size="xl" />
              <p>Không tìm thấy khóa học nào</p>
            </div>
          }

          <!-- Loading State -->
          @if (loadingCourses()) {
            <div class="loading-state">
              <app-icon name="arrow-path" size="xl" class="spin" />
              <p>Đang tải danh sách khóa học...</p>
            </div>
          }

          <!-- Error State -->
          @if (errorCourses()) {
            <div class="error-state">
              <app-icon name="exclamation-circle" size="xl" />
              <p>{{ errorCourses() }}</p>
            </div>
          }
        </div>
      }
    </div>

  </div>
</div>
